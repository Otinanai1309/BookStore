<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Implementing the Database in our project &mdash; books 2022 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Django Framework" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> books
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Django Framework</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implementing the Database in our project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-our-first-table">Create our first table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#admin-section-in-django">Admin Section in django</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#make-the-books-app-modifiable-in-the-admin">Make the books app modifiable in the admin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#handle-exception-error-doesnotexist">Handle exception error DoesNotExist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#form-csrf-token">Form CSRF Token</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generic-list-view">Generic List View</a></li>
<li class="toctree-l2"><a class="reference internal" href="#relationship-in-django">(02:46:41) Relationship in Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="#template-inheritance">⏳ (02:58:02) Template Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#many-to-many-relationship">⏳ (03:05:56) Many to Many Relationship</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-many-to-many-relationship">⏳ (03:19:07) Query Many to Many Relationship</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-intro">⏳ (03:26:29) Authentication Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#login-and-redirect-user">⏳ (03:33:42) Login and Redirect User</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-middleware">⏳ (03:41:23) Using Middleware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logout-a-user">⏳ (03:49:02) Logout a User</a></li>
<li class="toctree-l2"><a class="reference internal" href="#restrict-user-on-template">⏳ (03:58:50) Restrict user on template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-user-with-review">⏳ (04:04:38) Connect user with Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reset-password">⏳ (04:14:02) Reset Password</a></li>
<li class="toctree-l2"><a class="reference internal" href="#email-smtp-settings">⏳ (04:24:16) Email SMTP settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-upload-for-book">⏳(04:37:33) Image upload for Book</a></li>
<li class="toctree-l2"><a class="reference internal" href="#store-image-for-review">⏳ (04:48:21) Store image for Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-django-forms">⏳ (04:55:54) Working with Django Forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upload-file-with-model-form">⏳ (05:05:55) Upload File with model form</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-django-for-deployment">⏳ (05:17:35) Prepare Django for deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deploy-django-to-heroku">⏳ (05:30:53) Deploy Django to Heroku</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">books</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Implementing the Database in our project</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/development.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="implementing-the-database-in-our-project">
<h1>Implementing the Database in our project<a class="headerlink" href="#implementing-the-database-in-our-project" title="Permalink to this headline"></a></h1>
<section id="create-our-first-table">
<h2>Create our first table<a class="headerlink" href="#create-our-first-table" title="Permalink to this headline"></a></h2>
<p>Lets start creating our first table.
Using class Book at books.models.py we create our table.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">books</span><span class="o">/</span><span class="n">models</span><span class="o">.</span><span class="n">py</span>
</span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the commands makemigrations and migrate:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>python manage.py makemigrations
</span><span class="go">Migrations for &#39;books&#39;:</span>
<span class="go">books\migrations\0002_book_publisheddate.py</span>
<span class="go">    - Add field publishedDate to book</span>

<span class="hll"><span class="gp">$ </span>python manage.py migrate
</span><span class="go">Operations to perform:</span>
<span class="go">    Apply all migrations: admin, auth, books, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">    Applying contenttypes.0001_initial... OK</span>
<span class="go">    Applying auth.0001_initial... OK</span>
<span class="go">    Applying admin.0001_initial... OK</span>
<span class="go">    Applying admin.0002_logentry_remove_auto_add... OK</span>
<span class="go">    Applying admin.0003_logentry_add_action_flag_choices... OK</span>
<span class="go">    Applying contenttypes.0002_remove_content_type_name... OK</span>
<span class="go">    Applying auth.0002_alter_permission_name_max_length... OK</span>
<span class="go">    Applying auth.0003_alter_user_email_max_length... OK</span>
<span class="go">    Applying auth.0004_alter_user_username_opts... OK</span>
<span class="go">    Applying auth.0005_alter_user_last_login_null... OK</span>
<span class="go">    Applying auth.0006_require_contenttypes_0002... OK</span>
<span class="go">    Applying auth.0007_alter_validators_add_error_messages... OK</span>
<span class="go">    Applying auth.0008_alter_user_username_max_length... OK</span>
<span class="go">    Applying auth.0009_alter_user_last_name_max_length... OK</span>
<span class="go">    Applying auth.0010_alter_group_name_max_length... OK</span>
<span class="go">    Applying auth.0011_update_proxy_permissions... OK</span>
<span class="go">    Applying auth.0012_alter_user_first_name_max_length... OK</span>
<span class="go">    Applying books.0001_initial... OK</span>
<span class="go">    Applying books.0002_book_publisheddate... OK</span>
<span class="go">    Applying sessions.0001_initial... OK</span>
</pre></div>
</div>
<p>Our database has been created and we can view and edit it by using the <strong>SQLiteStudio</strong>.</p>
<p>If i want to read more about models we go to Documentation –&gt; Topic Guides –&gt;
Models and Databases –&gt; Models. There on top of the page under Models paragraph
there is a link Making queries (<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/db/queries/">https://docs.djangoproject.com/en/4.0/topics/db/queries/</a>).
There in the right side there is everything we might need.
We can now use our python shell and CRUD in the database if we want to.</p>
<p>Now we change our books.views.py in order to use our newly created database and not the json file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">books</span><span class="o">/</span><span class="n">views</span><span class="o">.</span><span class="n">py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="hll"><span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span>
</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">    :param request: [description]</span>
<span class="sd">    :type request: [type]</span>
<span class="sd">    :return: all the books that exists in our database</span>
<span class="sd">    :rtype: html file</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="n">dbData</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class="hll">    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;books&#39;</span><span class="p">:</span> <span class="n">dbData</span><span class="p">}</span>     <span class="c1"># is a way to pass data from the view to our templates</span>
</span>    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">    :param request: [description]</span>
<span class="sd">    :type request: [type]</span>
<span class="sd">    :param id: the id of the book</span>
<span class="sd">    :type id: int</span>
<span class="sd">    :return: [the book with given id]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="n">singlebook</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="c1"># we use .get and not .filter because we want an error to occure</span>
</span>    <span class="c1"># in case we pass an id that doesn&#39;t exist and not a collection of nothing.</span>
<span class="hll">    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="n">singlebook</span><span class="p">}</span>     <span class="c1"># is a way to pass data from the view to our templates</span>
</span>    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/show.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="admin-section-in-django">
<h2>Admin Section in django<a class="headerlink" href="#admin-section-in-django" title="Permalink to this headline"></a></h2>
<p>One more time we go to the documentation and open the Part2: Models and the admin site.
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/intro/tutorial02/">https://docs.djangoproject.com/en/4.0/intro/tutorial02/</a>)
To the right side of the page we choose –&gt; Introducing the Django Admin
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/intro/tutorial02/#introducing-the-django-admin">https://docs.djangoproject.com/en/4.0/intro/tutorial02/#introducing-the-django-admin</a>)</p>
<p><strong>Creating an admin user</strong>
First we’ll need to create a user who can login to the admin site. Run the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>python manage.py createsuperuser
</span><span class="go">Username (leave blank to use &#39;christos&#39;):</span>
<span class="go">Email address: otinanai1309@gmail.com</span>
<span class="go">Password: 13091965</span>
<span class="go">Password (again): 13091965</span>
<span class="go">This password is entirely numeric.</span>
<span class="go">Bypass password validation and create user anyway? [y/N]: y</span>
<span class="go">Superuser created successfully.</span>
</pre></div>
</div>
<p>If we now run the server and go to localhost/8000/admin we can see the page running.
So easy!!!</p>
<section id="make-the-books-app-modifiable-in-the-admin">
<h3>Make the books app modifiable in the admin<a class="headerlink" href="#make-the-books-app-modifiable-in-the-admin" title="Permalink to this headline"></a></h3>
<p>But where’s our books app? It’s not displayed on the admin index page.</p>
<p>Only one more thing to do: we need to tell the admin that book objects have an admin interface.
To do this, open the books/admin.py file, and edit it to look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">books</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">py</span>
</span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>
</span>
<span class="c1"># Register your models here.</span>
<span class="hll"><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span>
</span></pre></div>
</div>
<p>By registering the Book model to admin.py django knows all the fields that exists in our table.
But when we go to newly added books section in our admin site we see something like Book object (1) …
If we want to see the title instead we add a def within our models.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">books</span><span class="o">/</span><span class="n">models</span><span class="o">.</span><span class="n">py</span>
</span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="hll">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>
</span></pre></div>
</div>
</section>
</section>
<section id="handle-exception-error-doesnotexist">
<h2>Handle exception error DoesNotExist<a class="headerlink" href="#handle-exception-error-doesnotexist" title="Permalink to this headline"></a></h2>
<p>one more time we go to documentation –&gt; Part 3: Views and templates.
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/intro/tutorial03/">https://docs.djangoproject.com/en/4.0/intro/tutorial03/</a>). There on the right side there is a
Raising a 404 error (link) –&gt; (<a class="reference external" href="https://docs.djangoproject.com/en/4.0/intro/tutorial03/#raising-a-404-error">https://docs.djangoproject.com/en/4.0/intro/tutorial03/#raising-a-404-error</a>).</p>
<p>And if we follow instructions we have a new books/views.py file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/niews.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span><span class="p">,</span> <span class="n">HttpResponse</span>
</span><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">    :param request: [description]</span>
<span class="sd">    :type request: [type]</span>
<span class="sd">    :return: all the books that exists in our database</span>
<span class="sd">    :rtype: html file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dbData</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;books&#39;</span><span class="p">:</span> <span class="n">dbData</span><span class="p">}</span>     <span class="c1"># is a way to pass data from the view to our templates</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">    :param request: [description]</span>
<span class="sd">    :type request: [type]</span>
<span class="sd">    :param id: the id of the book</span>
<span class="sd">    :type id: int</span>
<span class="sd">    :return: [the book with given id]</span>
<span class="sd">    :rtype: [type]</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="k">try</span><span class="p">:</span>
</span><span class="hll">        <span class="n">singlebook</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="c1"># we use .get and not .filter because we want an error to occure</span>
</span><span class="hll">    <span class="k">except</span> <span class="n">Book</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class="hll">        <span class="c1"># in case we pass an id that doesn&#39;t exist and not a collection of nothing.</span>
</span><span class="hll">        <span class="k">raise</span> <span class="n">Http404</span><span class="p">(</span><span class="s2">&quot;The book you are looking for does not exists&quot;</span><span class="p">)</span>
</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="n">singlebook</span><span class="p">}</span>     <span class="c1"># is a way to pass data from the view to our templates</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/show.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>But we had to add 4 lines of code to handle the exception. Lets see if there is a shortcut in the documentation.
We search for “shortcut” and we choose Django shortcut functions link. On the right side we find the
get_object_or_404() link.</p>
<p>So we can have a new version of books/views.py file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books.views.py</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">dbData</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;books&#39;</span><span class="p">:</span> <span class="n">dbData</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="hll">    <span class="n">singlebook</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="c1"># shortcut for Try Except block</span>
</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="n">singlebook</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/show.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>If we want to see the real 404 page error we need to change the DEBUG = False
and add ALLOWED HOSTS = [‘127.0.0.1’, ‘localhost’,] to bookstore/settings.py file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">fabs</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Build paths inside the project like this: BASE_DIR / &#39;subdir&#39;.</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>

<span class="c1"># Quick-start development settings - unsuitable for production</span>
<span class="c1"># See https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/</span>

<span class="c1"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;django-insecure-ueg#9)g*ys1$p@la-=lpyzq4wdd-m_o7-k84^p(7nsv50h!ap)&#39;</span>

<span class="c1"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span class="hll"><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
</span>
<span class="hll"><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
</span><span class="hll">                <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span><span class="hll">                <span class="p">]</span>
</span>

<span class="c1"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;books&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;bookstore.urls&#39;</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;bookstore.wsgi.application&#39;</span>


<span class="c1"># Database</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#databases</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1"># Password validation</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#auth-password-validators</span>

<span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>


<span class="c1"># Internationalization</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/topics/i18n/</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;en-us&#39;</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1"># Static files (CSS, JavaScript, Images)</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/howto/static-files/</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="c1"># Default primary key field type</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field</span>

<span class="n">DEFAULT_AUTO_FIELD</span> <span class="o">=</span> <span class="s1">&#39;django.db.models.BigAutoField&#39;</span>
</pre></div>
</div>
</section>
<section id="form-csrf-token">
<h2>Form CSRF Token<a class="headerlink" href="#form-csrf-token" title="Permalink to this headline"></a></h2>
<p>Supose we want to add a review section to our bookstore site.
First of all lets assume that i want to write reviews for books.</p>
<p>So i need to create another model called Review with only one field named body and
a created_at field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/models.py</span>
</span><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>


<span class="hll"><span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</span><span class="hll">    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">book_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>
</div>
<p>We run the migrations in order to create the new table.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>python manage.py makemigrations
</span><span class="go">Migrations for &#39;books&#39;:</span>
<span class="go">    books\migrations\0003_review.py</span>
<span class="go">        - Create model Review</span>
<span class="hll"><span class="gp">$ </span>python manage.py migrate
</span><span class="go">Operations to perform:</span>
<span class="go">    Apply all migrations: admin, auth, books, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">    Applying books.0003_review... OK</span>
</pre></div>
</div>
<p>So after the migration of the new table in our database we have to create the url
that we will use in the ‘action’ of the ‘POST’ method in order to add the review option.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/urls.py</span>
</span><span class="kn">from</span> <span class="nn">unicodedata</span> <span class="kn">import</span> <span class="n">name</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book.all&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">show</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book.show&#39;</span><span class="p">),</span>
<span class="hll">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:id&gt;/review&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">review</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;book.review&quot;</span><span class="p">)</span>
</span><span class="p">]</span>
</pre></div>
</div>
<p>we will need to change a bit our books/views.py file in order to add the new review
functionality. shortcuts –&gt; Django shortcut functions –&gt; Redirect
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/http/shortcuts/#redirect">https://docs.djangoproject.com/en/4.0/topics/http/shortcuts/#redirect</a>)</p>
<p>and query–&gt;order_by (use ‘-’ minus sign for descending order)
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/models/querysets/#django.db.models.query.QuerySet">https://docs.djangoproject.com/en/4.0/ref/models/querysets/#django.db.models.query.QuerySet</a>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>

<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="hll"><span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">dbData</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;books&#39;</span><span class="p">:</span> <span class="n">dbData</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">singlebook</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="c1"># shortcut for Try Except block</span>
<span class="hll">    <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>    <span class="c1"># &#39;-&#39; minus sign is for desceding</span>
</span>    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="n">singlebook</span><span class="p">,</span> <span class="s1">&#39;reviews&#39;</span><span class="p">:</span> <span class="n">reviews</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/show.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="hll"><span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
</span><span class="hll">    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
</span><span class="hll">    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>We will also need to add a textarea to our show Form, with a submit button.</p>
<p>If we try to submit a review we get an CSRF token error. In order to bypass the error
we need to add django template tag csrf token. See at Documentation–&gt;Part 4: Forms and generic views
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/intro/tutorial04/">https://docs.djangoproject.com/en/4.0/intro/tutorial04/</a>)</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cp">&lt;!- templates/books/show.html -&gt;</span>
</span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.tailwindcss.com&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django Course<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;py-10&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;text-center text-4xl&#39;</span><span class="p">&gt;</span>{{book.title}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12 ml-20&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.thumbnailUrl}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> {{book.authors|join:&quot;, &quot;}} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="hll">            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                    {% csrf_token %}
</span><span class="hll">                    <span class="p">&lt;</span><span class="nt">textarea</span>
</span><span class="hll">                        <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
</span><span class="hll">                        <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
</span><span class="hll">                        <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
</span><span class="hll">                        <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                    <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
</span><span class="hll">                    <span class="p">&lt;</span><span class="nt">button</span>
</span><span class="hll">                        <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
</span><span class="hll">                        <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                        Submit
</span><span class="hll">                    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span><span class="hll">                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span><span class="hll">            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll">            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10 ml-20&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                {% for review in reviews %}
</span><span class="hll">                    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">                {% endfor %}
</span><span class="hll">
</span><span class="hll">            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll">        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Now we have all the basic functionality with review option per book activated.</p>
</section>
<section id="generic-list-view">
<h2>Generic List View<a class="headerlink" href="#generic-list-view" title="Permalink to this headline"></a></h2>
<p>Documentation –&gt;  Part 4: Forms and generic views –&gt; (right side) Use generic views: Less code is better
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/intro/tutorial04/#use-generic-views-less-code-is-better">https://docs.djangoproject.com/en/4.0/intro/tutorial04/#use-generic-views-less-code-is-better</a>).
The detail() (from Tutorial 3) and results() views are very short – and, as mentioned above, redundant.
The index() view, which displays a list of books, is similar.
These views represent a common case of basic web development: getting data from the database according
to a parameter passed in the URL, loading a template and returning the rendered template.
Because this is so common, Django provides a shortcut, called the “generic views” system.</p>
<p>Generic views abstract common patterns to the point where you don’t even need to write Python code to write an app.</p>
<p>Let’s convert our poll app to use the generic views system, so we can delete a bunch of our own code.
We’ll have to take a few steps to make the conversion. We will:</p>
<ol class="arabic simple">
<li><p>Convert the URLconf.</p></li>
<li><p>Delete some of the old, unneeded views.</p></li>
<li><p>Introduce new views based on Django’s generic views.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Why the code-shuffle?</p>
<p>Generally, when writing a Django app, you’ll evaluate whether generic views are a good fit for your problem,
and you’ll use them from the beginning, rather than refactoring your code halfway through.
But this tutorial intentionally has focused on writing the views “the hard way” until now,
to focus on core concepts.</p>
<p>You should know basic math before you start using a calculator.</p>
</div>
<p>So first of all, we open the books/urls.py URLconf and change it like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/urls.py</span>
</span><span class="kn">from</span> <span class="nn">unicodedata</span> <span class="kn">import</span> <span class="n">name</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
<span class="hll">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book.all&#39;</span><span class="p">),</span>
</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">show</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book.show&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:id&gt;/review&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">review</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;book.review&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>and right after that we change the books/views.py file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">generic</span>
</span>
<span class="hll"><span class="c1"># we create a new class where we list all books that will replace the index definition</span>
</span><span class="hll"><span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">ListView</span><span class="p">):</span>
</span><span class="hll">    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;books/index.html&#39;</span>
</span><span class="hll">    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
</span>
<span class="hll">    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span>

<span class="sd">&quot;&quot;&quot;def index(request):</span>
<span class="sd">    dbData = Book.objects.all()</span>
<span class="sd">    context = {&#39;books&#39;: dbData}</span>
<span class="sd">    return render(request, &#39;books/index.html&#39;, context)&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">singlebook</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="c1"># shortcut for Try Except block</span>
    <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>    <span class="c1"># &#39;-&#39; minus sign is for desceding</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="n">singlebook</span><span class="p">,</span> <span class="s1">&#39;reviews&#39;</span><span class="p">:</span> <span class="n">reviews</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/show.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this file we replace 4 lines of code with 5. Why is this better?
Because it is more generic. What i mean with that?
Let me introduce you with the power of generic thing.
If at <strong>books/views.py</strong> comment out the template_name line we will get an error that says
TemplateDoesNotExist (since we commented it out) but we see at the error that is looking for
a <strong>books/book_list.html</strong> file. That file in our project is books/index.html. So if we simply
rename the file we will get no-error. And voila it works!!! without even saying what is the
template name in our views.py django knows where to look for.</p>
<p>Now we have 4 lines in our class BookListView. Lets continue…
Instead of importing <strong>generic</strong> we can import directly <strong>ListView</strong> and since i have
installed correct extension Pack for Python in my VisualStudio Code i can simply type
ListView (press TAB) and choose class ListView which will autofill the class for me.</p>
<p>If we continue reading about <strong>context_object_name</strong> we will see that django is looking for
if we have given a name. If not django generates a name using ‘model name’_list which
in our case is <strong>book_list</strong>. So if we delete the line in our <strong>books/views.py</strong> file the
line <strong>context_object_name=books</strong> and go to books/book_list.html template and change the for
loop from books to book_list we will get the same result.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
</span>
<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="hll"><span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span>
<span class="hll">    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">singlebook</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="c1"># shortcut for Try Except block</span>
    <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>    <span class="c1"># &#39;-&#39; minus sign is for desceding</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book&#39;</span><span class="p">:</span> <span class="n">singlebook</span><span class="p">,</span> <span class="s1">&#39;reviews&#39;</span><span class="p">:</span> <span class="n">reviews</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/show.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now lets see what we can do with DetailView at show definition.
I one more time auto create the BookDetailView class filling up the minimal information that exists.
I change the books/urls.py and run the server to find out the errors that i will have.
and i get <strong>ImproperlyConfigured at /book/2
BookDetailView is missing a QuerySet. Define BookDetailView.model, BookDetailView.queryset,
or override BookDetailView.get_queryset().</strong> if i simply pass the class and this error if i leave the
model = Book information <strong>AttributeError at /book/2
Generic detail view BookDetailView must be called with either an object pk or a slug in the URLconf.</strong>
So i go to books/urls.py and change the ‘&lt;int:id&gt;’ to ‘&lt;int:pk&gt;’ and run again.
This time i get another error <strong>TemplateDoesNotExist at /book/2
books/book_detail.html</strong> That means that is looking for a books/book_detail.html file at the templates.
Lets rename our books/show.html to books/book_detail.html.
And voila it works!!! We are losing our reviews but we will tacle that soon.</p>
<p>In order to add back our reviews we are going to create a relationship between our books and
the reviews.</p>
</section>
<section id="relationship-in-django">
<h2>(02:46:41) Relationship in Django<a class="headerlink" href="#relationship-in-django" title="Permalink to this headline"></a></h2>
<p>One book can have many reviews so it is a One to Many relationship. Lets search Documentation
for relationship we find Many-to-one relationships (<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_one/">https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_one/</a>)</p>
<p>If we follow the instructions we first change the books/models.py file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/models.py</span>
</span><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>


<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we add null=True to avoid any errors that might have when i run the migration.</span>
</span></pre></div>
</div>
<p>We run the makemigrations:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>python manage.py makemigrations
</span><span class="go">Migrations for &#39;books&#39;:</span>
<span class="go">    books\migrations\0006_remove_review_book_id_review_book.py</span>
<span class="go">        - Remove field book_id from review</span>
<span class="go">        - Add field book to review</span>

<span class="hll"><span class="gp">$ </span>python manage.py migrate
</span><span class="go">Operations to perform:</span>
<span class="go">    Apply all migrations: admin, auth, books, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">    Applying books.0006_remove_review_book_id_review_book... OK</span>
</pre></div>
</div>
<p>and we add some code to books/views.py according to documentation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="c1"># reviews = Review.objects.filter(book_id=id).order_by(&#39;-created_at&#39;)    # &#39;-&#39; minus sign is for desceding</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

<span class="hll">    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">context</span>
</span>
<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="template-inheritance">
<h2>⏳ (02:58:02) Template Inheritance<a class="headerlink" href="#template-inheritance" title="Permalink to this headline"></a></h2>
<p>Documentation –&gt; (search for) Template –&gt; Template (API system) –&gt; Template Inheritance
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/templates/language/#template-inheritance">https://docs.djangoproject.com/en/4.0/ref/templates/language/#template-inheritance</a>)</p>
<p>The most powerful – and thus the most complex – part of Django’s template engine
is template inheritance. Template inheritance allows you to build a base “skeleton”
template that contains all the common elements of your site and defines blocks that
child templates can override.</p>
<p>In order to use template inheritance we need a base.html where we put just the basic html code.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!-- books/base.html --&gt;</span>
</span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.tailwindcss.com&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>

<span class="hll">        {% block title %}
</span><span class="hll">            Django Course
</span><span class="hll">        {% endblock title %}
</span>
    <span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;py-10 flex justify-center&quot;</span><span class="p">&gt;</span>
<span class="hll">        <span class="cm">&lt;!--Here i am going to create some tag--&gt;</span>
</span>
<span class="hll">        {% block content %}
</span><span class="hll">        <span class="cm">&lt;!-- When we extend this all content comes here  --&gt;</span>
</span>
<span class="hll">        {% endblock  %}
</span>

    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>and we will also change the two templates we are using.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!-- books/book_list.html --&gt;</span>
</span>
<span class="hll">{% extends &#39;books/base.html&#39; %}
</span><span class="hll">{% block title %}
</span>
<span class="hll">    all the books we have
</span>
<span class="hll">{% endblock title %}
</span>
<span class="hll">{% block content %}
</span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;text-center text*4xl&#39;</span><span class="p">&gt;</span>Programming Books<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;grid grid-cols-4 gap-4 mt-10&quot;</span><span class="p">&gt;</span>
            {% for book in book_list %}
            <span class="p">&lt;</span><span class="nt">a</span>
                <span class="na">href</span><span class="o">=</span><span class="s">&quot; {% url &#39;book.show&#39; book.id %} &quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;justify-self-center text-center my-4&quot;</span>
                <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span>
            <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot; {{ book.thumbnailUrl }} &quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-700&quot;</span><span class="p">&gt;</span> {{ book.title }} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="hll">{% endblock %}
</span></pre></div>
</div>
<p>And the second template file with details:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!-- books/book_detail.html --&gt;</span>
</span>
<span class="hll">{% extends &#39;books/base.html&#39; %}
</span>
<span class="hll">{% block title %}
</span><span class="hll">    book details for - {{book.title}}
</span><span class="hll">{% endblock title %}
</span>
<span class="hll">{% block content %}
</span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center text-4xl&quot;</span><span class="p">&gt;</span>{{ book.title }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.thumbnailUrl}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> {{book.authors|join:&quot;, &quot;}} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="hll">{% endblock %}
</span></pre></div>
</div>
</section>
<section id="many-to-many-relationship">
<h2>⏳ (03:05:56) Many to Many Relationship<a class="headerlink" href="#many-to-many-relationship" title="Permalink to this headline"></a></h2>
<p>Documentation–&gt;relationship-&gt;Many-to-many relationships
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_many/">https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_many/</a>)</p>
<p>We will implement the author of each book. But now there is the difference
because one book may have many authors but one author can write many books too.</p>
<p>So, we have a Many to Many Relationship.</p>
<p>First, as expected we have to create a new model for our authors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/models.py</span>
</span><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>
<span class="hll"><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
</span><span class="hll">    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>
<span class="hll">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>


<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we add null=True to avoid any errors that might have when i run the migration.</span>
</pre></div>
</div>
<p>After thet we make the migrations for our database.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>python manage.py makemigrations
</span><span class="go">Migrations for &#39;books&#39;:</span>
<span class="go">    books\migrations\0007_author_book_authors.py</span>
<span class="go">    - Create model Author</span>
<span class="go">    - Add field authors to book</span>
<span class="hll"><span class="gp">$ </span>python manage.py migrate
</span><span class="go">Operations to perform:</span>
<span class="go">    Apply all migrations: admin, auth, books, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">    Applying books.0007_author_book_authors... OK</span>
</pre></div>
</div>
<p>So, now we have created two more tables. One for the authors and one for the many to many relationship.</p>
<p>A few more steps to complete tha authors addition.</p>
<p>Register to admin.py the new Author class and also import it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/admin.py</span>
</span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Author</span>
</span>
<span class="c1"># Register your models here.</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span>
<span class="hll"><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
</span></pre></div>
</div>
<p>After thta change we can go to admin site and add a few authors.
Just by adding the authors django’s magic, give us the posibility when we edit or add
a new book to add the author (authors) of the book.</p>
<p>If we try to add in our detailed view template the author by addin a for loop within author div</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// books/book_detail.html
</span>...
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>
<span class="hll">        {% for author in book.authors %}
</span><span class="hll">            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> {{author}} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">        {% endfor %}
</span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
...
</pre></div>
</div>
<p>and then run the server we get an error: TypeError at /book/3
‘ManyRelatedManager’ object is not iterable.
So, we need to create a new context with the authors of each book.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
<span class="hll">        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
</span>        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and the full code for detailed template is:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// books/book_detail.html
</span>{% extends &#39;books/base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center text-4xl&quot;</span><span class="p">&gt;</span>{{ book.title }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.thumbnailUrl}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="hll">                    {% for author in authors %}
</span><span class="hll">                        {{author}} ,
</span><span class="hll">                    {% endfor %}
</span>                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>and voila it works!!!</p>
</section>
<section id="query-many-to-many-relationship">
<h2>⏳ (03:19:07) Query Many to Many Relationship<a class="headerlink" href="#query-many-to-many-relationship" title="Permalink to this headline"></a></h2>
<p>If for example we want to see others books of an author then we should add a url
within author div of the detailed template. But if we want this to work without throughing
an error we have to add the url to the books/urls.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/urls.py</span>
</span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book.all&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;book.show&#39;</span><span class="p">),</span>
<span class="hll">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:id&gt;/review&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">review</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;book.review&quot;</span><span class="p">),</span>
</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;str:author&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">author</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;author.book&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Now back to the books/views.py we need to build a definition named author
where i will try to filter the data. But how can i filter a many to many relationship.
Lets go to (<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_many/">https://docs.djangoproject.com/en/4.0/topics/db/examples/many_to_many/</a>) we
can see how we can use the filter function.
<strong>He is using the name we used in models.py for the many to many relationship
inside Book class followed by double underscore and then the field name of the authors table.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="hll"><span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
</span><span class="hll">    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
</span><span class="hll">    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span>
<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="authentication-intro">
<h2>⏳ (03:26:29) Authentication Intro<a class="headerlink" href="#authentication-intro" title="Permalink to this headline"></a></h2>
<p>Right now anyone can write a review but we should accept reviews only by loged in users.
Documentation–&gt; (search for) Authentication –&gt; User authentication in Django
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/auth/">https://docs.djangoproject.com/en/4.0/topics/auth/</a>)</p>
<p>Django by default provides out of the box the authentication and authorization for groups and users.
Now lets go to the end of the page and press the link (Using the Django authentication system)</p>
</section>
<section id="login-and-redirect-user">
<h2>⏳ (03:33:42) Login and Redirect User<a class="headerlink" href="#login-and-redirect-user" title="Permalink to this headline"></a></h2>
<p>In the same documentation page to the right side we find and press (Authentication Views)
<strong>Authentication Views</strong>
Django provides several views that you can use for handling login, logout, and password management.
These make use of the stock auth forms but you can pass in your own forms as well.</p>
<p>Django provides no default template for the authentication views. You should create your own templates
for the views you want to use. The template context is documented in each view, see All authentication views.</p>
<p><strong>Using the views</strong>
There are different methods to implement these views in your project. The easiest way is to include the
provided URLconf in django.contrib.auth.urls in your own URLconf, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;accounts/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;django.contrib.auth.urls&#39;</span><span class="p">)),</span>
</span><span class="hll"><span class="p">]</span>
</span><span class="c1"># This will include the following URL patterns:</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">login</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">logout</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_change</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_change</span><span class="o">/</span><span class="n">done</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change_done&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_reset</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_reset</span><span class="o">/</span><span class="n">done</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_done&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">reset</span><span class="o">/&lt;</span><span class="n">uidb64</span><span class="o">&gt;/&lt;</span><span class="n">token</span><span class="o">&gt;/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_confirm&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">reset</span><span class="o">/</span><span class="n">done</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_complete&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>So if we add at bookstore/urls.py a new line like … path(‘’, include(‘django.contrib.auth.urls’)),…
and try to run server using <strong>http://127.0.0.1:8000/login/</strong> we get an error message
TemplateDoesNotExist at /login/
<strong>registration/login.html</strong>
We understand that django automaticly tries to route at localhost/registration/login.html within the templates
folder of the projects folder.</p>
<p>So we just have to create a file within bookstore named <strong>templates/registration/login.html.</strong>
We take the content of the html file directly from the documentation and we add it to our newly
created file.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// bookstore/templates/registration/login.html
</span><span class="hll">{% extends &quot;base.html&quot; %} // we need a bookstore/templates/base.html file
</span><span class="hll">// we copy the file from our books/templates/books/base.html
</span>
{% block content %}

{% if form.errors %}
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your username and password didn&#39;t match. Please try again.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endif %}

{% if next %}
    {% if user.is_authenticated %}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your account doesn&#39;t have access to this page. To proceed,
    please login with an account that has access.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% else %}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Please login to see this page.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endif %}
{% endif %}

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}&quot;</span><span class="p">&gt;</span>
{% csrf_token %}
<span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ form.username.label_tag }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ form.username }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ form.password.label_tag }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ form.password }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ next }}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

{# Assumes you set up the password_reset view in your URLconf #}
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;password_reset&#39; %}&quot;</span><span class="p">&gt;</span>Lost password?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<p>But again if we try to run server we get the same error message. Thats because
doesn’t know where to look for templates files inside project.</p>
<p>Lets add a line to bookstore/settings.py file to indicate where is templates folder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Django settings for bookstore project.</span>

<span class="sd">Generated by &#39;django-admin startproject&#39; using Django 4.0.1.</span>

<span class="sd">For more information on this file, see</span>
<span class="sd">https://docs.djangoproject.com/en/4.0/topics/settings/</span>

<span class="sd">For the full list of settings and their values, see</span>
<span class="sd">https://docs.djangoproject.com/en/4.0/ref/settings/</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="hll"><span class="kn">import</span> <span class="nn">os</span>
</span>
<span class="c1"># Build paths inside the project like this: BASE_DIR / &#39;subdir&#39;.</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>


<span class="c1"># Quick-start development settings - unsuitable for production</span>
<span class="c1"># See https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/</span>

<span class="c1"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;django-insecure-ueg#9)g*ys1$p@la-=lpyzq4wdd-m_o7-k84^p(7nsv50h!ap)&#39;</span>

<span class="c1"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
                <span class="p">]</span>


<span class="c1"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;books&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;bookstore.urls&#39;</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
<span class="hll">        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">BASE_DIR</span><span class="p">),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
</span>        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;bookstore.wsgi.application&#39;</span>


<span class="c1"># Database</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#databases</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1"># Password validation</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#auth-password-validators</span>

<span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>


<span class="c1"># Internationalization</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/topics/i18n/</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;en-us&#39;</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1"># Static files (CSS, JavaScript, Images)</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/howto/static-files/</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="c1"># Default primary key field type</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field</span>

<span class="n">DEFAULT_AUTO_FIELD</span> <span class="o">=</span> <span class="s1">&#39;django.db.models.BigAutoField&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Now we check again our server by restarting and VOILA!!! our login page works fine.
But now we have two base.html files in two different folders. Lets try to fix this by
changing our books/book_detail.html and books/book_list.html files. We just need to change
the first line of code where we extend the base.html and delete the books/base.html file.</p>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// books/book_list.html
</span><span class="hll">// books/book_detail.html
</span>
<span class="hll">{% extends &#39;base.html&#39; %}
</span>...
</pre></div>
</div>
<p>Now, if i try to login a user i get an error message:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Page not found (404)
    Request Method: GET
<span class="hll">        Request URL:        http://127.0.0.1:8000/accounts/profile/
</span>Using the URLconf defined in bookstore.urls, Django tried these URL patterns, in this order:

    books/
    book/
    admin/
    login/ [name=&#39;login&#39;]
    logout/ [name=&#39;logout&#39;]
    password_change/ [name=&#39;password_change&#39;]
    password_change/done/ [name=&#39;password_change_done&#39;]
    password_reset/ [name=&#39;password_reset&#39;]
    password_reset/done/ [name=&#39;password_reset_done&#39;]
    reset/<span class="p">&lt;</span><span class="nt">uidb64</span><span class="p">&gt;</span>/<span class="p">&lt;</span><span class="nt">token</span><span class="p">&gt;</span>/ [name=&#39;password_reset_confirm&#39;]
    reset/done/ [name=&#39;password_reset_complete&#39;]
<span class="hll">    The current path, accounts/profile/, didn’t match any of these.
</span></pre></div>
</div>
<p>To fix this error we use again the documentation
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#how-to-log-a-user-in">https://docs.djangoproject.com/en/4.0/topics/auth/default/#how-to-log-a-user-in</a>)
–&gt;  <strong>LOGIN_REDIRECT_URL</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here’s what LoginView does:</p>
<p>If called via GET, it displays a login form that POSTs to the same URL. More on this in a bit.
If called via POST with user submitted credentials, it tries to log the user in. If login is
successful, the view redirects to the URL specified in next. If next isn’t provided, it redirects
to settings.LOGIN_REDIRECT_URL (which defaults to /accounts/profile/).</p>
<p><strong>So we go to bookstore/settings.py and add at the end the line LOGIN_REDIRECT_URL = ‘/book’.</strong></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span>
<span class="o">...</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="hll"><span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/book&#39;</span>
</span>
<span class="c1"># Default primary key field type</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field</span>

<span class="n">DEFAULT_AUTO_FIELD</span> <span class="o">=</span> <span class="s1">&#39;django.db.models.BigAutoField&#39;</span>
</pre></div>
</div>
</section>
<section id="using-middleware">
<h2>⏳ (03:41:23) Using Middleware<a class="headerlink" href="#using-middleware" title="Permalink to this headline"></a></h2>
<p>But if we try to login again the page is available to me. So we need to restrict certain Operations.
At the same documentation page we find a class based mixin <strong>The LoginRequired mixin</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The LoginRequired mixin
When using class-based views, you can achieve the same behavior as with login_required
by using the LoginRequiredMixin. This mixin should be at the leftmost position in the
inheritance list.</p>
<dl>
<dt>class LoginRequiredMixin</dt><dd><p>If a view is using this mixin, all requests by non-authenticated users will be redirected
to the login page or shown an HTTP 403 Forbidden error, depending on the raise_exception
parameter.</p>
<p>You can set any of the parameters of AccessMixin to customize the handling of unauthorized
users:</p>
</dd>
</dl>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
</span>
<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="n">login_url</span> <span class="o">=</span> <span class="s1">&#39;/login/&#39;</span>
    <span class="n">redirect_field_name</span> <span class="o">=</span> <span class="s1">&#39;redirect_to&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Just as the login_required decorator, this mixin does NOT check the is_active flag on a user,
but the default AUTHENTICATION_BACKENDS reject inactive users.</p>
</div>
<figure class="align-default">
<img alt="_images/7F5y.gif" src="_images/7F5y.gif" />
</figure>
<p>So if i implement in my books/views.py this mixin i get the behavior i want from our programm.
For example if i login as a user1 and right after i visit <strong>localhost/admin</strong> i get a django
administration warning.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You are authenticated as user1, but are not authorized to access this page. Would you like
to login to a different account?</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
</span>

<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="hll"><span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span> <span class="c1"># add as first parameter LoginRequiredMixin</span>
</span><span class="hll">    <span class="n">login_url</span> <span class="o">=</span> <span class="s1">&#39;/login/&#39;</span>
</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to avoid writing in every class in my books/views.py the login_url=’/login’ and by doing so,
make every user who visits site to login first i can add this code to my bookstore/settings.py file once.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span>
<span class="o">...</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/book&#39;</span>

<span class="hll"><span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>  <span class="c1"># just one time here</span>
</span>
<span class="c1"># Default primary key field type</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field</span>

<span class="n">DEFAULT_AUTO_FIELD</span> <span class="o">=</span> <span class="s1">&#39;django.db.models.BigAutoField&#39;</span>
</pre></div>
</div>
<p>And very important according the documentation we need to add a line within
<strong>bookstore/urls.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/urls.py</span>
</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;books/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;books.urls&#39;</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;book/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;books.urls&#39;</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="hll">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">redirect_authenticated_user</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="c1"># we add this path just before the contrib.auth.urls</span>
</span>    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;django.contrib.auth.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="logout-a-user">
<h2>⏳ (03:49:02) Logout a User<a class="headerlink" href="#logout-a-user" title="Permalink to this headline"></a></h2>
<p>Because we have implemented the login status of a user we have to implement the logout status too.
First pf all we change a bit our <strong>templates/base.html and templates/registration/login.html</strong>
We added a nav bar with a logout button on the right side and a nav_title block within base.html.
After that a minor change to <strong>books/book_list.html and books/book_detail.html</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// templates/base.html
</span>{% extends &quot;base.html&quot; %}

{% block nav_title %}
    Login
{% endblock %}

{% block content %}




<span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>

<span class="hll">
</span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bg-gray-100 p-4 rounded shadow&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}&quot;</span><span class="p">&gt;</span>
{% csrf_token %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between py-2&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mr-4&quot;</span><span class="p">&gt;</span>{{ form.username.label_tag }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="hll">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>{{ form.username }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between py-2&quot;</span><span class="p">&gt;</span>
</span><span class="hll">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mr-4&quot;</span><span class="p">&gt;</span>{{ form.password.label_tag }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>{{ form.password }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span class="hll"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;login&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;py-1 px-2 mt-5 bg-green-400 text-white rounded w-full cursor-pointer hover:bg-green-800&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ next }}&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-sm mt-5&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;password_reset&#39; %}&quot;</span><span class="p">&gt;</span>Lost password?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
{# Assumes you setup the password_reset view in your URLconf #}


{% endblock %}


<span class="cm">&lt;!-- {% if form.errors %}</span>
<span class="cm">&lt;p&gt;Your username and password didn&#39;t match. Please try again.&lt;/p&gt;</span>
<span class="cm">{% endif %}</span>

<span class="cm">{% if next %}</span>
<span class="cm">    {% if user.is_authenticated %}</span>
<span class="cm">    &lt;p&gt;Your account doesn&#39;t have access to this page. To proceed,</span>
<span class="cm">    please login with an account that has access.&lt;/p&gt;</span>
<span class="cm">    {% else %}</span>
<span class="cm">    &lt;p&gt;Please login to see this page.&lt;/p&gt;</span>
<span class="cm">    {% endif %}</span>
<span class="cm">{% endif %} --&gt;</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// books/book_list.html
</span>{% extends &#39;base.html&#39; %}


{% block title %}

    all the books we have

{% endblock title %}



<span class="hll">{% block nav_title %}
</span><span class="hll">    Programming Books
</span><span class="hll">{% endblock %}
</span>

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;grid grid-cols-4 gap-4 mt-10&quot;</span><span class="p">&gt;</span>
            {% for book in book_list %}
            <span class="p">&lt;</span><span class="nt">a</span>
                <span class="na">href</span><span class="o">=</span><span class="s">&quot; {% url &#39;book.show&#39; book.id %} &quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;justify-self-center text-center my-4&quot;</span>
                <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span>
            <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot; {{ book.thumbnailUrl }} &quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-700&quot;</span><span class="p">&gt;</span> {{ book.title }} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"># books/book_detail.html
</span>{% extends &#39;base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}



<span class="hll">{% block nav_title %}
</span><span class="hll">
</span><span class="hll">    {{ book.title }}
</span><span class="hll">
</span><span class="hll">{% endblock %}
</span>

{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.thumbnailUrl}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% for author in authors %}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;author.books&#39; author %}&quot;</span><span class="p">&gt;</span>{{author}} ,<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Now in order to logout a user we should use the
{<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/auth/default/">https://docs.djangoproject.com/en/4.0/topics/auth/default/</a>}–&gt; Class LogoutView</p>
<p>So looging out a user is as simple as adding an href tag with the ‘/logout’ url added
at the templates/base.url but as we see when we logout we get redirected to our Django
administration login page. In order to avoid this we need to create a
templates/registration/logged_out.html template.</p>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll">// templates/registration/logged_out.html
</span>{% extends &#39;base.html&#39; %}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-full &quot;</span><span class="p">&gt;</span> You have been successfully loged out <span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/login&quot;</span><span class="p">&gt;</span> Login Again<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>We also need to add a line to our bookstore/settings.py.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span><span class="o">...</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/book&#39;</span>

<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>
<span class="hll"><span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>
</span><span class="o">...</span>
</pre></div>
</div>
</section>
<section id="restrict-user-on-template">
<h2>⏳ (03:58:50) Restrict user on template<a class="headerlink" href="#restrict-user-on-template" title="Permalink to this headline"></a></h2>
<p>Up until now we made our site to be available only for logged in users, but the correct
thing to do is to give access to book_list and book_detail to anyone and just Restrict
access just when someone wants to add a review. Then we should ask for login action.
We no more want the books behind the authentication wall.</p>
<p>In order to do this I have to go to books/views.py and remove the LoginRequiredMixin from the
parameters of the classes and stop importing it to.</p>
<p>So we need to change two files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="hll"><span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="hll"><span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>

    <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--books/book_detail.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}



{% block nav_title %}

    {{ book.title }}

{% endblock %}


{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.thumbnailUrl}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% for author in authors %}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;author.books&#39; author %}&quot;</span><span class="p">&gt;</span>{{author}} ,<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
<span class="hll">            {% if user.is_authenticated %}
</span>            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="cm">&lt;!--i use the ?next={{request.path}} because i want to be redirected to the same page where i want</span>
<span class="cm">                to add a review.--&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-blue-600&quot;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}?next={{request.path}}&quot;</span><span class="p">&gt;</span>Login <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to write review
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endif %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
</section>
<section id="connect-user-with-review">
<h2>⏳ (04:04:38) Connect user with Review<a class="headerlink" href="#connect-user-with-review" title="Permalink to this headline"></a></h2>
<p>Now lets try to connect each review with the user that wrote it.
So in our books/models.py we have a class named Review where we need to connect each review
with the user. That means, we have to create a ForeignKey to connect with model User.
We remember that User model derives from django.contrib.auth.models.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/models.py</span>
</span><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="hll"><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</span>
<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>


<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
<span class="hll">    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span>    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we add null=True to avoid any errors that might have when i run the migration.</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="p">:</span>
</span>        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>
<span class="hll">        <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span>        <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"># books/book_detail.html
</span>{% extends &#39;base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}



{% block nav_title %}

    {{ book.title }}

{% endblock %}


{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.thumbnailUrl}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% for author in authors %}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;author.books&#39; author %}&quot;</span><span class="p">&gt;</span>{{author}} ,<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            {% if user.is_authenticated %}
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="cm">&lt;!--i use the ?next={{request.path}} because i want to be redirected to the same page where i want</span>
<span class="cm">                to add a review.--&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-blue-600&quot;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}?next={{request.path}}&quot;</span><span class="p">&gt;</span>Login <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to write review
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endif %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-20 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
<span class="hll">                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-6&quot;</span><span class="p">&gt;</span>
</span><span class="hll">                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--flex means in the same row and the other means to the left and right end--&gt;</span>
</span><span class="hll">                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.user }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.created_at }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll">                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span>                    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="hll">                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span>            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
</section>
<section id="reset-password">
<h2>⏳ (04:14:02) Reset Password<a class="headerlink" href="#reset-password" title="Permalink to this headline"></a></h2>
<p>Documentation–&gt;(Search) Authentication –&gt; User authentication in Django –&gt;  Using the Django authentication
–&gt; Authentication Views (<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#module-django.contrib.auth.views">https://docs.djangoproject.com/en/4.0/topics/auth/default/#module-django.contrib.auth.views</a>)
there we can find a <strong>class PasswordResetView</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>class PasswordResetView
<strong>URL name: localhost/password_reset/</strong></p>
<p>Allows a user to reset their password by generating a one-time use link that can be used
to reset the password, and sending that link to the user’s registered email address.</p>
<p>This view will send an email if the following conditions are met:</p>
<p>The email address provided exists in the system.
The requested user is active (User.is_active is True).
The requested user has a usable password. Users flagged with an unusable password
(see set_unusable_password()) aren’t allowed to request a password reset to prevent
misuse when using an external authentication source like LDAP.
If any of these conditions are not met, no email will be sent, but the user won’t
receive any error message either. This prevents information leaking to potential attackers.
If you want to provide an error message in this case, you can subclass PasswordResetForm
and use the form_class attribute.
Attributes:</p>
<p>template_name
The full name of a template to use for displaying the password reset form.
Defaults to <strong>registration/password_reset_form.html</strong> if not supplied.</p>
<p>form_class
Form that will be used to get the email of the user to reset the password for. Defaults to PasswordResetForm.</p>
<p>email_template_name
The full name of a template to use for generating the email with the reset password link. Defaults to registration/password_reset_email.html if not supplied.</p>
<p>subject_template_name
The full name of a template to use for the subject of the email with the reset password link. Defaults to registration/password_reset_subject.txt if not supplied.</p>
<p>token_generator
Instance of the class to check the one time link. This will default to default_token_generator, it’s an instance of django.contrib.auth.tokens.PasswordResetTokenGenerator.</p>
<p>success_url
The URL to redirect to after a successful password reset request.
Defaults to ‘password_reset/done/’.</p>
<p>from_email</p>
</div>
<p>So in order to make our own template work we just need a <strong>templates/registration/password_reset_form.html</strong>
file.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--registration/password_reset_form.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

<span class="cm">&lt;!-- Content --&gt;</span>

{% block content %}

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {% csrf_token %}
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>Enter your email to get reset password Link<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span>
        <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
        <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
        <span class="na">id</span><span class="o">=</span><span class="s">&quot;email&quot;</span>
        <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2&quot;</span>
        <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Enter Your Email&quot;</span>
        <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span>
        <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
        <span class="na">value</span><span class="o">=</span><span class="s">&quot;Reset My Password&quot;</span>
        <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 bg-green-700 text-white cursor-pointer&quot;</span>
        <span class="p">/&gt;</span>

    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<p>Now we have to build our <strong>class PasswordResetDoneView</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>class PasswordResetDoneView
<strong>URL name: localhost/password_reset/done/</strong></p>
<p>The page shown after a user has been emailed a link to reset their password.
This view is called by default if the PasswordResetView doesn’t have an explicit
success_url URL set.
If the email address provided does not exist in the system, the user is inactive,
or has an unusable password, the user will still be redirected to this view but
no email will be sent.
Attributes:
template_name
The full name of a template to use.
Defaults to <strong>registration/password_reset_done.html</strong> if not supplied.</p>
<p>extra_context
A dictionary of context data that will be added to the default context data passed
to the template.</p>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--templates/registration/password_reset_done.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

<span class="cm">&lt;!--Content--&gt;</span>

{% block content %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;m-auto&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-2xl&quot;</span><span class="p">&gt;</span>Password reset sent<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-4 text-gray-800&quot;</span><span class="p">&gt;</span>
            We’ve emailed you instructions for setting your password, if an account
            exists with the email you entered. You should receive them shortly.
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-4 text-gray-800&quot;</span><span class="p">&gt;</span>
            If you don’t receive an email, please make sure you’ve entered the address
            you registered with, and check your spam folder.
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="email-smtp-settings">
<h2>⏳ (04:24:16) Email SMTP settings<a class="headerlink" href="#email-smtp-settings" title="Permalink to this headline"></a></h2>
<p>Documentation–&gt;Topic guides–&gt;Sending email–&gt;Email backends–&gt;File backend
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/email/#email-backends">https://docs.djangoproject.com/en/4.0/topics/email/#email-backends</a>)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file backend writes emails to a file. A new file is created for each new session that
is opened on this backend. The directory to which the files are written is either taken
from the EMAIL_FILE_PATH setting or from the file_path keyword when creating a connection
with get_connection().</p>
<p>To specify this backend, put the following in your settings:
EMAIL_BACKEND = ‘django.core.mail.backends.filebased.EmailBackend’
EMAIL_FILE_PATH = ‘/tmp/app-messages’ # change this to a proper location</p>
<p>This backend is not intended for use in production – it is provided as a convenience that
can be used during development.</p>
</div>
<p>and by adding these two line in <strong>bookstore/settings.py</strong> i follow the reset password path i have
auto created the path and within the email send by our server with the link. But this works only
in development mode note during production.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span><span class="o">...</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/book&#39;</span>

<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>
<span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>

<span class="hll"><span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.filebased.EmailBackend&#39;</span>
</span><span class="n">EMAIL_FILE_PATH</span> <span class="o">=</span><span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;tmp/app-messages&#39;</span>
</pre></div>
</div>
<p>So, lets try the real SMTP way.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>SMTP backend
class backends.smtp.EmailBackend(host=None, port=None, username=None, password=None,
use_tls=None, fail_silently=False, use_ssl=None, timeout=None, ssl_keyfile=None,
ssl_certfile=None, <strong>kwargs)</strong>
This is the default backend. Email will be sent through a SMTP server.</p>
<p>The value for each argument is retrieved from the matching setting if the argument is None:</p>
<ol class="arabic simple">
<li><p>host: EMAIL_HOST</p></li>
<li><p>port: EMAIL_PORT</p></li>
<li><p>username: EMAIL_HOST_USER</p></li>
<li><p>password: EMAIL_HOST_PASSWORD</p></li>
<li><p>use_tls: EMAIL_USE_TLS</p></li>
<li><p>use_ssl: EMAIL_USE_SSL</p></li>
<li><p>timeout: EMAIL_TIMEOUT</p></li>
<li><p>ssl_keyfile: EMAIL_SSL_KEYFILE</p></li>
<li><p>ssl_certfile: EMAIL_SSL_CERTFILE</p></li>
</ol>
<div class="line-block">
<div class="line">The SMTP backend is the default configuration inherited by Django. If you want to specify
it explicitly, put the following in your settings:</div>
</div>
<p>EMAIL_BACKEND = ‘django.core.mail.backends.smtp.EmailBackend’</p>
<div class="line-block">
<div class="line">If unspecified, the default timeout will be the one provided by socket.getdefaulttimeout(),
which defaults to None (no timeout).</div>
</div>
</div>
<p>We will try to use mailtrap site (login as <a class="reference external" href="mailto:otinanai1309&#37;&#52;&#48;gmail&#46;com">otinanai1309<span>&#64;</span>gmail<span>&#46;</span>com</a>) where at their Demo imbox
within the Integration there is a set of lines just for Django settings.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s1">&#39;smtp.mailtrap.io&#39;</span>
<span class="n">EMAIL_HOST_USER</span> <span class="o">=</span> <span class="s1">&#39;af16296ee37376&#39;</span>
<span class="n">EMAIL_HOST_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;96b6c123b0d796&#39;</span>
<span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="s1">&#39;2525&#39;</span>
</pre></div>
</div>
<p>We add these lines to our bookstore/settings.py file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Django settings for bookstore project.</span>

<span class="sd">Generated by &#39;django-admin startproject&#39; using Django 4.0.1.</span>

<span class="sd">For more information on this file, see</span>
<span class="sd">https://docs.djangoproject.com/en/4.0/topics/settings/</span>

<span class="sd">For the full list of settings and their values, see</span>
<span class="sd">https://docs.djangoproject.com/en/4.0/ref/settings/</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Build paths inside the project like this: BASE_DIR / &#39;subdir&#39;.</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>


<span class="c1"># Quick-start development settings - unsuitable for production</span>
<span class="c1"># See https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/</span>

<span class="c1"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;django-insecure-ueg#9)g*ys1$p@la-=lpyzq4wdd-m_o7-k84^p(7nsv50h!ap)&#39;</span>

<span class="c1"># SECURITY WARNING: don&#39;t run with debug turned on in production!</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
                <span class="p">]</span>


<span class="c1"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;books&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;bookstore.urls&#39;</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">BASE_DIR</span><span class="p">),</span> <span class="s1">&#39;templates&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;bookstore.wsgi.application&#39;</span>


<span class="c1"># Database</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#databases</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1"># Password validation</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#auth-password-validators</span>

<span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>


<span class="c1"># Internationalization</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/topics/i18n/</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;en-us&#39;</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;UTC&#39;</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1"># Static files (CSS, JavaScript, Images)</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/howto/static-files/</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/book&#39;</span>

<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>
<span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>

<span class="hll"><span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s1">&#39;smtp.mailtrap.io&#39;</span>
</span><span class="hll"><span class="n">EMAIL_HOST_USER</span> <span class="o">=</span> <span class="s1">&#39;af16296ee37376&#39;</span>
</span><span class="hll"><span class="n">EMAIL_HOST_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;96b6c123b0d796&#39;</span>
</span><span class="hll"><span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="s1">&#39;2525&#39;</span>
</span>

<span class="c1"># Default primary key field type</span>
<span class="c1"># https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field</span>

<span class="n">DEFAULT_AUTO_FIELD</span> <span class="o">=</span> <span class="s1">&#39;django.db.models.BigAutoField&#39;</span>
</pre></div>
</div>
<p>Now if i press the link given to the email for reseting the password we redirect to the
Django Administration reset password page. By inspecting the code of the page we see what we
have to do in order to make a page of our own.</p>
<p>Documentation–&gt;Authentication–&gt;Using the Django authentication system–&gt;Authentication Views
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#module-django.contrib.auth.views">https://docs.djangoproject.com/en/4.0/topics/auth/default/#module-django.contrib.auth.views</a>)</p>
<p>First of all i need the <strong>accounts/reset/&lt;uidb64&gt;/&lt;token&gt;/ [name=’password_reset_confirm’]</strong></p>
<p>So i search for password_reset_confirm in documentation page and i find:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="line-block">
<div class="line">class PasswordResetConfirmView</div>
<div class="line">URL name: password_reset_confirm</div>
</div>
<div class="line-block">
<div class="line">Presents a form for entering a new password.</div>
</div>
<div class="line-block">
<div class="line">Keyword arguments from the URL:</div>
</div>
<div class="line-block">
<div class="line">uidb64: The user’s id encoded in base 64.</div>
<div class="line">token: Token to check that the password is valid.</div>
</div>
<div class="line-block">
<div class="line">Attributes:</div>
</div>
<div class="line-block">
<div class="line">template_name</div>
<div class="line">The full name of a template to display the confirm password view. Default value is registration/password_reset_confirm.html.</div>
</div>
<div class="line-block">
<div class="line">token_generator</div>
<div class="line">Instance of the class to check the password. This will default to default_token_generator, it’s an instance of django.contrib.auth.tokens.PasswordResetTokenGenerator.</div>
</div>
<div class="line-block">
<div class="line">post_reset_login</div>
<div class="line">A boolean indicating if the user should be automatically authenticated after a successful password reset. Defaults to False.</div>
</div>
<div class="line-block">
<div class="line">post_reset_login_backend</div>
<div class="line">A dotted path to the authentication backend to use when authenticating a user if post_reset_login is True. Required only if you have multiple AUTHENTICATION_BACKENDS configured. Defaults to None.</div>
</div>
<div class="line-block">
<div class="line">form_class</div>
<div class="line">Form that will be used to set the password. Defaults to SetPasswordForm.</div>
</div>
<div class="line-block">
<div class="line">success_url</div>
<div class="line-block">
<div class="line">URL to redirect after the password reset done. Defaults to ‘password_reset_complete’.</div>
</div>
</div>
<div class="line-block">
<div class="line">extra_context</div>
<div class="line">A dictionary of context data that will be added to the default context data passed to the template.</div>
</div>
<div class="line-block">
<div class="line">reset_url_token</div>
<div class="line">Token parameter displayed as a component of password reset URLs. Defaults to ‘set-password’.</div>
</div>
<div class="line-block">
<div class="line">Template context:</div>
</div>
<div class="line-block">
<div class="line">form: The form (see form_class above) for setting the new user’s password.</div>
<div class="line">validlink: Boolean, True if the link (combination of uidb64 and token) is valid or unused yet.</div>
</div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--registration/password_reset_done.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

<span class="cm">&lt;!--Content--&gt;</span>

{% block content %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;m-auto&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-2xl&quot;</span><span class="p">&gt;</span>Password reset sent<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-4 text-gray-800&quot;</span><span class="p">&gt;</span>
            We’ve emailed you instructions for setting your password, if an account
            exists with the email you entered. You should receive them shortly.
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-4 text-gray-800&quot;</span><span class="p">&gt;</span>
            If you don’t receive an email, please make sure you’ve entered the address
            you registered with, and check your spam folder.
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--registration/password_reset_confirm.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

<span class="cm">&lt;!--content--&gt;</span>


{% block content %}


<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;m-auto&quot;</span><span class="p">&gt;</span>
        {% if validlink %}
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-2xl&quot;</span><span class="p">&gt;</span>Enter New Password<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
            Please enter your new password twice so we can verify you typed it in correctly.
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            {% csrf_token %}
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;new_password1&quot;</span><span class="p">&gt;</span>Enter new password:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                {{form.new_password1 }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;new_password2&quot;</span><span class="p">&gt;</span>Confirm password:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                {{form.new_password2 }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Change My Password&quot;</span><span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

        {% else %}
        <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-2xl&quot;</span><span class="p">&gt;</span>Password Reset was unsuccessfull<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
            The password reset link was invalid, probably because it has already been used.
            Please request a new password reset.
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

        {% endif %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="image-upload-for-book">
<h2>⏳(04:37:33) Image upload for Book<a class="headerlink" href="#image-upload-for-book" title="Permalink to this headline"></a></h2>
<p>Now, instead of using amazon static url for the book images we will upload the images to our project.
Documentation–&gt;Topic Guides–&gt;Managing files–&gt;(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/files/">https://docs.djangoproject.com/en/4.0/topics/files/</a>)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="line-block">
<div class="line">Using files in models</div>
<div class="line">When you use a FileField or ImageField, Django provides a set of APIs you can use to deal with that file.</div>
</div>
<div class="line-block">
<div class="line">Consider the following model, using an ImageField to store a photo:</div>
</div>
<div class="line-block">
<div class="line">from django.db import models</div>
</div>
<div class="line-block">
<div class="line">class Car(models.Model):</div>
</div>
<blockquote>
<div><p>name = models.CharField(max_length=255)
price = models.DecimalField(max_digits=5, decimal_places=2)
photo = models.ImageField(upload_to=’cars’)
specs = models.FileField(upload_to=’specs’)</p>
</div></blockquote>
<div class="line-block">
<div class="line">Any Car instance will have a photo attribute that you can use to get at the details of the attached photo:</div>
</div>
<div class="line-block">
<div class="line">&gt;&gt;&gt; car = Car.objects.get(name=”57 Chevy”)</div>
<div class="line">&gt;&gt;&gt; car.photo</div>
<div class="line">&lt;ImageFieldFile: cars/chevy.jpg&gt;</div>
<div class="line">&gt;&gt;&gt; car.photo.name</div>
<div class="line">‘cars/chevy.jpg’</div>
<div class="line">&gt;&gt;&gt; car.photo.path</div>
<div class="line">‘/media/cars/chevy.jpg’</div>
<div class="line">&gt;&gt;&gt; car.photo.url</div>
<div class="line">‘<a class="reference external" href="http://media.example.com/cars/chevy.jpg">http://media.example.com/cars/chevy.jpg</a>’</div>
<div class="line">This object – car.photo in the example – is a File object, which means it has all the methods and attributes described below.</div>
</div>
<div class="line-block">
<div class="line">The file is saved as part of saving the model in the database, so the actual file name used</div>
<div class="line">on disk cannot be relied on until after the model has been saved.</div>
</div>
</div>
<p>We add to books/models.py one line and run migrations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/models.py</span>
</span><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">thumbnailUrl</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
<span class="hll">    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>


<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we add null=True to avoid any errors that might have when i run the migration.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before running migrations i install Pillow because it is Required:
Cannot use ImageField because Pillow is not installed.
|    HINT: Get Pillow at <a class="reference external" href="https://pypi.org/project/Pillow/">https://pypi.org/project/Pillow/</a> or run command “python -m pip install Pillow”.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>python -m pip install Pillow
</span><span class="go">Collecting Pillow</span>
<span class="go">Downloading Pillow-9.0.1-cp38-cp38-win_amd64.whl (3.2 MB)</span>
<span class="go">    |████████████████████████████████| 3.2 MB 1.1 MB/s</span>
<span class="go">Installing collected packages: Pillow</span>
<span class="go">Successfully installed Pillow-9.0.1</span>
<span class="go">WARNING: You are using pip version 21.3.1; however, version 22.0.3 is available.</span>
<span class="go">You should consider upgrading via the &#39;C:\MyDjangoProjects\django_Framework\venv\Scripts\python.exe -m pip</span>
<span class="go">install --upgrade pip&#39; command.</span>
<span class="hll"><span class="gp">$ </span>.<span class="se">\m</span>anage.py makemigrations
</span><span class="go">Migrations for &#39;books&#39;:</span>
<span class="go">books\migrations\0009_book_image.py</span>
<span class="go">    - Add field image to book</span>
<span class="hll"><span class="gp">$ </span>.<span class="se">\m</span>anage.py migrate
</span><span class="go">Operations to perform:</span>
<span class="go">    Apply all migrations: admin, auth, books, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">    Applying books.0009_book_image... OK</span>
</pre></div>
</div>
<p>How can i upload the images to my project?
I can do that just by using my admin panel but before that i go to documentation
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/howto/static-files/">https://docs.djangoproject.com/en/4.0/howto/static-files/</a>) and follow the instructions</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serving static files during development
If you use django.contrib.staticfiles as explained above, runserver will do this automatically when DEBUG is set to True.
If you don’t have django.contrib.staticfiles in INSTALLED_APPS, you can still manually serve static files using the
django.views.static.serve() view.</p>
<p>This is not suitable for production use! For some common deployment strategies, see How to deploy static files.</p>
<p>For example, if your STATIC_URL is defined as static/, you can do this by adding the following snippet to your urls.py:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... the rest of your URLconf goes here ...</span>
<span class="p">]</span> <span class="o">+</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span><span class="p">)</span>
</pre></div>
</div>
<p>So first of all:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/settings.py</span>
</span><span class="o">...</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">&#39;static/&#39;</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/book&#39;</span>

<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>
<span class="n">LOGOUT_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span>

<span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s1">&#39;smtp.mailtrap.io&#39;</span>
<span class="n">EMAIL_HOST_USER</span> <span class="o">=</span> <span class="s1">&#39;af16296ee37376&#39;</span>
<span class="n">EMAIL_HOST_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;96b6c123b0d796&#39;</span>
<span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="s1">&#39;2525&#39;</span>
<span class="hll">
</span><span class="hll"><span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="s2">&quot;media&quot;</span>    <span class="c1"># when we define ROOT no slash is needed.</span>
</span><span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s2">&quot;media/&quot;</span>    <span class="c1"># when we define URL a slash is always needed!!!</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># bookstore/urls.py</span>
</span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="hll"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>
</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># path(&#39;book/&#39;, include(&#39;books.urls&#39;)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;books.urls&#39;</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">redirect_authenticated_user</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span> <span class="c1"># we add this path just before the contrib.auth.urls</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;django.contrib.auth.urls&#39;</span><span class="p">)),</span>
<span class="hll"><span class="p">]</span> <span class="o">+</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--books/book_list.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}


{% block title %}

    all the books we have

{% endblock title %}



{% block nav_title %}
    Programming Books
{% endblock %}


{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;grid grid-cols-4 gap-4 mt-10&quot;</span><span class="p">&gt;</span>
            {% for book in book_list %}
            <span class="p">&lt;</span><span class="nt">a</span>
                <span class="na">href</span><span class="o">=</span><span class="s">&quot; {% url &#39;book.show&#39; book.id %} &quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;justify-self-center text-center my-4&quot;</span>
                <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span>
            <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-center&quot;</span><span class="p">&gt;</span>
<span class="hll">                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot; {{ book.image.url }} &quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
</span>                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-lg text-gray-700&quot;</span><span class="p">&gt;</span> {{ book.title }} <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--books/book_detail.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}



{% block nav_title %}

    {{ book.title }}

{% endblock %}


{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
<span class="hll">                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.image.url}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
</span>                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% for author in authors %}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;author.books&#39; author %}&quot;</span><span class="p">&gt;</span>{{author}} ,<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            {% if user.is_authenticated %}
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600 ml-20&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="cm">&lt;!--i use the ?next={{request.path}} because i want to be redirected to the same page where i want</span>
<span class="cm">                to add a review.--&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-blue-600&quot;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}?next={{request.path}}&quot;</span><span class="p">&gt;</span>Login <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to write review
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endif %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-20 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-6&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--flex means in the same row and the other means to the left and right end--&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.user }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.created_at }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>And everything works fine!!!</p>
</section>
<section id="store-image-for-review">
<h2>⏳ (04:48:21) Store image for Review<a class="headerlink" href="#store-image-for-review" title="Permalink to this headline"></a></h2>
<p>Lets add a new field for user who writes a review maybe to upload a file.
So i add an image field to books/models.py.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/models.py</span>
</span><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">publishedDate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="hll">    <span class="c1"># deleted the thumbnail url that is no longer in use.</span>
</span>    <span class="n">shortDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">longDescription</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># with this def we see the id and the title of the book in admin page</span>


<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># we add null=True to avoid any errors that might have when i run the migration.</span>
<span class="hll">    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span> <span class="o">=</span> <span class="s2">&quot;images/review&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Run the migrations:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>.<span class="se">\m</span>anage.py makemigrations
</span><span class="go">Migrations for &#39;books&#39;:</span>
<span class="go">books\migrations\0010_remove_book_thumbnailurl_review_image.py</span>
<span class="go">    - Remove field thumbnailUrl from book</span>
<span class="go">    - Add field image to review</span>
<span class="gp">$ </span>.<span class="se">\m</span>anage.py migrate
<span class="go">Operations to perform:</span>
<span class="go">    Apply all migrations: admin, auth, books, contenttypes, sessions</span>
<span class="go">Running migrations:</span>
<span class="go">    Applying books.0010_remove_book_thumbnailurl_review_image... OK</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--books/book_detail.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}



{% block nav_title %}

    {{ book.title }}

{% endblock %}


{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.image.url}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% for author in authors %}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;author.books&#39; author %}&quot;</span><span class="p">&gt;</span>{{author}} ,<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            {% if user.is_authenticated %}
<span class="hll">            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/</span>
</span><span class="hll"><span class="s">            form-data&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--We added the enctype in order to be able to handle the image we added</span>
</span><span class="hll"><span class="cm">            to user review--&gt;</span>
</span>                {% csrf_token %}
                <span class="p">&lt;</span><span class="nt">textarea</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;border rounded p-2 w-full text-gray-600&quot;</span>
                <span class="na">name</span><span class="o">=</span><span class="s">&quot;review&quot;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write your review here&quot;</span>
                <span class="na">rows</span><span class="o">=</span><span class="s">&quot;5&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
<span class="hll">            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;image&quot;</span><span class="p">&gt;</span>
</span>
            <span class="p">&lt;</span><span class="nt">button</span>
                <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                Submit
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="cm">&lt;!--i use the ?next={{request.path}} because i want to be redirected to the same page where i want</span>
<span class="cm">                to add a review.--&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-blue-600&quot;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}?next={{request.path}}&quot;</span><span class="p">&gt;</span>Login <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to write review
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endif %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-20 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-6&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--flex means in the same row and the other means to the left and right end--&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.user }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.created_at }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="hll">                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{review.image}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;100&quot;</span><span class="p">&gt;</span>
</span>                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>Documentation–&gt;(search for storage)–&gt; File storage API–&gt;The FileSystemStorage class
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/files/storage/">https://docs.djangoproject.com/en/4.0/ref/files/storage/</a>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="hll"><span class="kn">from</span> <span class="nn">django.core.files.storage</span> <span class="kn">import</span> <span class="n">FileSystemStorage</span>
</span>
<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="p">:</span>
<span class="hll">        <span class="n">image</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">fs</span> <span class="o">=</span> <span class="n">FileSystemStorage</span><span class="p">()</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span>        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]</span>   <span class="c1"># &#39;review&#39; is the name of the textarea in books/show.html</span>
<span class="hll">        <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">image</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span>        <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This approach works, but its now the correct way to upload an image.</p>
</section>
<section id="working-with-django-forms">
<h2>⏳ (04:55:54) Working with Django Forms<a class="headerlink" href="#working-with-django-forms" title="Permalink to this headline"></a></h2>
<p>So in order to upload a file we will the same technique we used in django administration upload
file. For this we need documentation–&gt; Topic guides –&gt; Working with forms
(<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/forms/">https://docs.djangoproject.com/en/4.0/topics/forms/</a>)</p>
<p>Normally when we work with a form we have something like:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/your-name/&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;your_name&quot;</span><span class="p">&gt;</span>Your name: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;your_name&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;your_name&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ current_name }}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;OK&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>But when we build a form in Django we can use the Form class.
We already know what we want our HTML form to look like. Our starting point for it in Django is this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># forms.py</span>
</span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">NameForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">your_name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Your name&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>This defines a Form class with a single field (your_name). We’ve applied a human-friendly label to the field, which will appear in the &lt;label&gt; when it’s rendered (although in this case, the label we specified is actually the same one that would be generated automatically if we had omitted it).</p>
<p>The field’s maximum allowable length is defined by max_length. This does two things. It puts a maxlength=”100” on the HTML &lt;input&gt; (so the browser should prevent the user from entering more than that number of characters in the first place). It also means that when Django receives the form back from the browser, it will validate the length of the data.</p>
<p>A Form instance has an is_valid() method, which runs validation routines for all its fields. When this method is called, if all fields contain valid data, it will:</p>
<ul class="simple">
<li><p>return True</p></li>
<li><p>place the form’s data in its cleaned_data attribute.</p></li>
</ul>
<p>The whole form, when rendered for the first time, will look like:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;your_name&quot;</span><span class="p">&gt;</span>Your name: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;your_name&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;your_name&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;100&quot;</span> <span class="na">required</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Note that it does not include the &lt;form&gt; tags, or a submit button. We’ll have to provide those ourselves in the template.
We create a new file within books direcrory named form.py (I named it forms.py after documentation instructions)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/forms.py</span>
</span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">ReviewForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="s2">&quot;border rounded p-2 w-full text-gray-600&quot;</span><span class="p">,</span>
                                                        <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s2">&quot;Enter your review here ...&quot;</span><span class="p">}</span> <span class="p">))</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>and change a bit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="kn">from</span> <span class="nn">django.core.files.storage</span> <span class="kn">import</span> <span class="n">FileSystemStorage</span>
<span class="hll"><span class="kn">from</span> <span class="nn">books.forms</span> <span class="kn">import</span> <span class="n">ReviewForm</span>
</span>
<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
<span class="hll">        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReviewForm</span><span class="p">()</span>
</span>        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="hll"><span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="p">:</span>
</span><span class="hll">        <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span>
</span><span class="hll">        <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="hll">            <span class="n">image</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
</span><span class="hll">            <span class="n">fs</span> <span class="o">=</span> <span class="n">FileSystemStorage</span><span class="p">()</span>
</span><span class="hll">            <span class="n">name</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span class="hll">            <span class="n">newReview</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span>
        <span class="n">newReview</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="cm">&lt;!--books/book_detail.html--&gt;</span>
</span>{% extends &#39;base.html&#39; %}

{% block title %}
    book details for - {{book.title}}
{% endblock title %}



{% block nav_title %}

    {{ book.title }}

{% endblock %}


{% block content %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-10/12 mt-10&quot;</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between mt-10&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-3/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{book.image.url}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-9/12&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>{{book.shortDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span>Total {{book.pageCount}} pages<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Author<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-5&quot;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        {% for author in authors %}
                            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;author.books&#39; author %}&quot;</span><span class="p">&gt;</span>{{author}} ,<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                        {% endfor %}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-3xl&quot;</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-600 mt-4&quot;</span><span class="p">&gt;</span>{{book.longDescription}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-10&quot;</span><span class="p">&gt;</span>
            {% if user.is_authenticated %}
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;book.review&#39; book.id %}&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="p">&gt;</span>
                {% csrf_token %}
                {{form.as_p}}
                <span class="cm">&lt;!-- &lt;&lt;textarea</span>
<span class="cm">                        class=&quot;border rounded p-2 w-full text-gray-600&quot;</span>
<span class="cm">                        name=&quot;review&quot;</span>
<span class="cm">                        placeholder=&quot;Write your review here&quot;</span>
<span class="cm">                        rows=&quot;5&quot;&gt;</span>
<span class="cm">                    &lt;/textarea&gt;</span>
<span class="cm">                    &lt;input type=&quot;file&quot; name=&quot;image&quot;&gt;&gt; --&gt;</span>

                <span class="p">&lt;</span><span class="nt">button</span>
                    <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>
                    <span class="na">class</span><span class="o">=</span><span class="s">&quot;float-right border rounded p-2 bg-gray-800 text-white&quot;</span><span class="p">&gt;</span>
                    Submit
                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="cm">&lt;!--i use the ?next={{request.path}} because i want to be redirected to the same page where i want</span>
<span class="cm">                to add a review.--&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-blue-600&quot;</span>  <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;login&#39; %}?next={{request.path}}&quot;</span><span class="p">&gt;</span>Login <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> to write review
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            {% endif %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mt-20 ml-20&quot;</span><span class="p">&gt;</span>
            {% for review in reviews %}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;my-6&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flex justify-between&quot;</span><span class="p">&gt;</span> <span class="cm">&lt;!--flex means in the same row and the other means to the left and right end--&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.user }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-gray-400&quot;</span><span class="p">&gt;</span>{{ review.created_at }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ review.body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    {% if review.image %}
                    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{review.image.url}}&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;100&quot;</span> <span class="p">&gt;</span>
                    {% endif %}

                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>And everything is working one more time!!!</p>
</section>
<section id="upload-file-with-model-form">
<h2>⏳ (05:05:55) Upload File with model form<a class="headerlink" href="#upload-file-with-model-form" title="Permalink to this headline"></a></h2>
<p>Documentation–&gt; Creating forms from models–&gt; {<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/forms/modelforms/">https://docs.djangoproject.com/en/4.0/topics/forms/modelforms/</a>}</p>
<p>I wont explain much just i will give the final files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/forms.py</span>
</span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Review</span>

<span class="hll"><span class="k">class</span> <span class="nc">ReviewForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
</span><span class="hll">    <span class="n">body</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="s2">&quot;border rounded p-2 w-full text-gray-600&quot;</span><span class="p">,</span>
</span><span class="hll">                                                        <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s2">&quot;Enter your review here ...&quot;</span><span class="p">}</span> <span class="p">))</span>
</span><span class="hll">    <span class="n">image</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="hll">        <span class="n">model</span> <span class="o">=</span> <span class="n">Review</span>
</span>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">]</span>

        <span class="c1"># Or we can define widgets here like that</span>
        <span class="sd">&quot;&quot;&quot;widgets = {&#39;body&#39;: forms.Textarea(attrs={&#39;class&#39;:&quot;border rounded p-2 w-full text-gray-600&quot;,</span>
<span class="sd">                                                        &#39;placeholder&#39;: &quot;Enter your review here ...&quot;}),</span>
<span class="sd">                    &#39;image&#39;: forms.ImageField(required=False)</span>
<span class="sd">                    }&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># books/views.py</span>
</span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">books.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>

<span class="kn">from</span> <span class="nn">django.core.files.storage</span> <span class="kn">import</span> <span class="n">FileSystemStorage</span>
<span class="hll"><span class="kn">from</span> <span class="nn">books.forms</span> <span class="kn">import</span> <span class="n">ReviewForm</span>
</span>
<span class="c1"># we create a new class where we list all books that will replace the index definition</span>
<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-created_at&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;book&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># we fetch all the authors and create the context</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReviewForm</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">authors__name</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;book_list&#39;</span><span class="p">:</span> <span class="n">books</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;books/book_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="hll"><span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span> <span class="p">:</span>
</span><span class="hll">        <span class="n">newReview</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">book_id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</span><span class="hll">        <span class="n">form</span> <span class="o">=</span> <span class="n">ReviewForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">newReview</span><span class="p">)</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span><span class="hll">            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="prepare-django-for-deployment">
<h2>⏳ (05:17:35) Prepare Django for deployment<a class="headerlink" href="#prepare-django-for-deployment" title="Permalink to this headline"></a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">deploy.md</span>
</span><span class="go">manage.py check --deploy</span>

<span class="go">- secret key</span>

<span class="go">- debug</span>

<span class="go">- database</span>
<span class="go">    -. pip install dj-database-url</span>
<span class="go">    -. pip install psycopg2-binary</span>

<span class="go">- bookstore/settings.py</span>
<span class="go">    -. import dj_database_url</span>
<span class="go">    -. &#39;default&#39;: dj_database_url.config(conn_max_age=500)</span>

<span class="go">- serving static files</span>
<span class="go">    -. static root</span>

<span class="go">- pip install whitenoise</span>

<span class="go">- add this line at the MIDDLEWARE at the second position</span>
<span class="go">    -. &#39;whitenoise.middleware.WhiteNoiseMiddleware&#39;,</span>

<span class="go">HTTP Server pip install gunicorn</span>

<span class="go">export requirements  pip freeze &gt; requirements.txt</span>

<span class="go">For Heroku procfile web: gunicorn projectName.wsgi --log-file -</span>

<span class="go">Create Heroku app and Add Allowed hosts</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>.<span class="se">\m</span>anage.py check --deploy
<span class="go">System check identified some issues:</span>

<span class="go">WARNINGS:</span>
<span class="go">?: (security.W004) You have not set a value for the SECURE_HSTS_SECONDS setting. If your entire site is served only over SSL, you may want to consider setting a value and enabling HTTP Strict Transport Security. Be sure to read the documentation first; enabling HSTS carelessly can cause serious, irreversible problems.</span>
<span class="go">?: (security.W008) Your SECURE_SSL_REDIRECT setting is not set to True. Unless your site should be available over both SSL and non-SSL connections, you may want to either set this setting True or configure a load balancer or reverse-proxy server to redirect all connections to HTTPS.</span>
<span class="go">?: (security.W009) Your SECRET_KEY has less than 50 characters, less than 5 unique characters, or it&#39;s prefixed with &#39;django-insecure-&#39; indicating that it was generated automatically by Django. Please generate a long and random SECRET_KEY, otherwise many of Django&#39;s security-critical features will be vulnerable to attack.</span>
<span class="go">?: (security.W012) SESSION_COOKIE_SECURE is not set to True. Using a secure-only session cookie makes it more difficult for network traffic sniffers to hijack user sessions.</span>
<span class="go">?: (security.W016) You have &#39;django.middleware.csrf.CsrfViewMiddleware&#39; in your MIDDLEWARE, but you have not set CSRF_COOKIE_SECURE to True. Using a secure-only CSRF cookie makes it more difficult for network traffic sniffers to steal the CSRF token.</span>
<span class="go">?: (security.W018) You should not have DEBUG set to True in deployment.</span>

<span class="go">System check identified 6 issues (0 silenced).</span>
</pre></div>
</div>
<p>So we start fixing all these issues. They are all within bookstore/settings.py</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$ </span>pip freeze &gt; requirements.txt
</span>
<span class="gp">$ </span>pip install dj-database-url
<span class="go">Collecting dj-database-url</span>
<span class="go">    Downloading dj_database_url-0.5.0-py2.py3-none-any.whl (5.5 kB)</span>
<span class="go">Installing collected packages: dj-database-url</span>
<span class="go">Successfully installed dj-database-url-0.5.0</span>
<span class="go">WARNING: You are using pip version 21.3.1; however, version 22.0.3 is available.</span>
<span class="go">You should consider upgrading via the &#39;C:\MyDjangoProjects\django_Framework\venv\Scripts\python.exe -m pip install --upgrade pip&#39; command.</span>

<span class="gp">$ </span>pip install psycopg2-binary
<span class="go">Collecting psycopg2-binary</span>
<span class="go">    Downloading psycopg2_binary-2.9.3-cp38-cp38-win_amd64.whl (1.1 MB)</span>
<span class="go">        |████████████████████████████████| 1.1 MB 819 kB/s</span>
<span class="go">Installing collected packages: psycopg2-binary</span>
<span class="go">Successfully installed psycopg2-binary-2.9.3</span>
<span class="go">WARNING: You are using pip version 21.3.1; however, version 22.0.3 is available.</span>
<span class="go">You should consider upgrading via the &#39;C:\MyDjangoProjects\django_Framework\venv\Scripts\python.exe -m pip install --upgrade pip&#39; command.</span>

<span class="gp">$ </span>pip install whitenoise
<span class="go">Collecting whitenoise</span>
<span class="go">    Downloading whitenoise-6.0.0-py3-none-any.whl (19 kB)</span>
<span class="go">Installing collected packages: whitenoise</span>
<span class="go">Successfully installed whitenoise-6.0.0</span>
<span class="go">WARNING: You are using pip version 21.3.1; however, version 22.0.3 is available.</span>
<span class="go">You should consider upgrading via the &#39;C:\MyDjangoProjects\django_Framework\venv\Scripts\python.exe -m pip install --upgrade pip&#39; command.</span>

<span class="gp">$ </span>pip install gunicorn
<span class="go">Collecting gunicorn</span>
<span class="go">    Downloading gunicorn-20.1.0-py3-none-any.whl (79 kB)</span>
<span class="go">        |████████████████████████████████| 79 kB 2.6 MB/s</span>
<span class="go">Requirement already satisfied: setuptools&gt;=3.0 in c:\mydjangoprojects\django_framework\venv\lib\site-packages (from gunicorn) (60.0.5)</span>
<span class="go">Installing collected packages: gunicorn</span>
<span class="go">Successfully installed gunicorn-20.1.0</span>

<span class="gp">$ </span>pip freeze &gt; requirements.txt
</pre></div>
</div>
<p>These are the steps we need to do for deployment on any server not just for Heroku.</p>
</section>
<section id="deploy-django-to-heroku">
<h2>⏳ (05:30:53) Deploy Django to Heroku<a class="headerlink" href="#deploy-django-to-heroku" title="Permalink to this headline"></a></h2>
<p>Follow the instructions found (<a class="reference external" href="https://devcenter.heroku.com/articles/django-app-configuration">https://devcenter.heroku.com/articles/django-app-configuration</a>)</p>
<p>Create a new file under Bookstore_Project/procfile</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">web: gunicorn bookstore.wsgi --log-file -</span>
</span></pre></div>
</div>
<p>Now we can go to heroku website and choose  Command line (<a class="reference external" href="https://devcenter.heroku.com/categories/command-line">https://devcenter.heroku.com/categories/command-line</a>)</p>
<p>Press the Install Heroku CLI button and download the 64 bit version windows installer and install Heroku.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">$</span>
</span><span class="gp">$ </span>heroku login
<span class="go">heroku: Press any key to open up the browser to login or q to exit:</span>
<span class="go">Opening browser to https://cli-auth.heroku.com/auth/cli/browser/89bf4667-d39a-4194-9c70-5eb06e0b6ade?requestor=SFMyNTY.g2gDbQAAAAw3OS4xMDMuMTMzLjNuBgCIoRUOfwFiAAFRgA.5r6ESOcXnaNFx2Wqh6uZO08yMlhGVryHdNsR8Op6B-M</span>
<span class="go">Logging in... done</span>
<span class="go">Logged in as karamichailidis@gmail.com</span>
<span class="hll">
</span><span class="gp">$ </span>heroku create
<span class="go">Creating app... done, ⬢ hidden-plains-58943</span>
<span class="go">https://hidden-plains-58943.herokuapp.com/ | https://git.heroku.com/hidden-plains-58943.git</span>
</pre></div>
</div>
<p>we add this <a class="reference external" href="https://hidden-plains-58943.herokuapp.com/">https://hidden-plains-58943.herokuapp.com/</a> to ALLOWED_HOSTS on settings.py</p>
<figure class="align-default">
<img alt="_images/kj.gif" src="_images/kj.gif" />
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Django Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Karamichailidis Christos.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>